Synchronize directory replicas using version vectors.


Run

./main.py --help


Version Vectors

A Version Vector is a map from replica IDs (strings) to counters (integers).

X ⊑ Y ⇔ every replica ID in X exists in Y and its X counter ≤ its Y counter.
{A:1}		⊑ {A:1}
{A:1}		⊑ {A:2, B:3}
{A:1, B:2}	⋢ {B:3}
{A:1, B:2}	⋢ {A:3, B:1}
{A:1, B:2}	⊑ {A:1, B:3}

X ⊔ Y (join) has the union of X and Y's replica IDs.
A replica ID's counter is the maximum of its couters in X and Y
if it is present in both, else its counter from X or Y where it is present.
{A:1} ⊔ {A:2}	= {A:2}
{A:1} ⊔ {B:2}	= {A:1, B:2}
{A:1, B:4, C:2, D:6} ⊔ {B:3, C:2, D:7, E:9} = {A:1, B:4, C:2, D:7, E:9}


Replicas

A replica is a directory. The file '.vector-sync' in its root stores:
- ID (name) of the replica.
- version vector: {replica_id1: counter1, replica_id2: counter2, …}.
- files: {path1: hash1, path2: hash2, …} for each file.
All '.vector-sync' descendants of the directory are excluded from the sync.

Initializing a new replica with ID A creates the metadata file:
- ID: A
- version vector: {}
- files: {}

Synchronizing replicas A and B:
For each replica R in {A, B}:
Vr ← version vector, Mr ← 'files' metadata, Dr ← directory content.
If Dr ≠ Mr, increment R's counter in Vr (set it to 1 if R is not in Vr).
This has not been written to disk, only calculated in memory.
- If Da = Db, set A and B's metadata to (Va ⊔ Vb, Da)
- else if Va = Vb, error: the user must match the trees then run the sync again
- else if Va ⊑ Vb, replace A's dir with Db, set A and B's metadata to (Vb, Db)
- else if Vb ⊑ Va, replace B's dir with Da, set A and B's metadata to (Va, Da)
- else error: diverged, the user must match the tress then run the sync again
